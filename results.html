<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz App - Results</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h3 id="testNameHeader">Results</h3>
        <div id="resultsContainer"></div>
        <canvas id="resultsChart"></canvas>
        <p id="finalScore"></p>
        <button id="newExamBtn" class="button new-exam-btn">New Exam</button>
    </div>
    <script>
        const questions = [
            { question: "What is 2 + 2?", options: ["3", "4", "5"], answer: 1 },
            { question: "What is the capital of France?", options: ["Berlin", "Madrid", "Paris"], answer: 2 },
            // Add more questions here...
        ];

        const urlParams = new URLSearchParams(window.location.search);
        const results = JSON.parse(decodeURIComponent(urlParams.get('results')));
        
        const resultsContainer = document.getElementById("resultsContainer");
        let correctCount = 0;
        let incorrectCount = 0;
        let missedCount = 0;

        questions.forEach((q, index) => {
            const userAnswer = results[index];
            const correctAnswer = q.answer;

            const resultDiv = document.createElement("div");
            resultDiv.classList.add("result");
            const isCorrect = userAnswer == correctAnswer;

            if (userAnswer === undefined) {
                missedCount++;
                resultDiv.innerHTML = `Q${index + 1}: Missed! Correct answer: ${q.options[correctAnswer]}`;
            } else {
                if (isCorrect) {
                    correctCount++;
                    resultDiv.innerHTML = `Q${index + 1}: Correct! Your answer: ${q.options[userAnswer]}`;
                } else {
                    incorrectCount++;
                    resultDiv.innerHTML = `Q${index + 1}: Incorrect! Your answer: ${q.options[userAnswer]}, Correct answer: ${q.options[correctAnswer]}`;
                }
            }

            resultsContainer.appendChild(resultDiv);
        });

        const score = correctCount * 4 - incorrectCount;
        document.getElementById("finalScore").textContent = `Final Score: ${score} / ${questions.length * 4}`;

        // Chart
        const ctx = document.getElementById('resultsChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Correct', 'Incorrect', 'Missed'],
                datasets: [{
                    label: 'Results',
                    data: [correctCount, incorrectCount, missedCount],
                    backgroundColor: ['green', 'red', 'orange'],
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        document.getElementById("newExamBtn").addEventListener("click", function() {
            localStorage.removeItem('quizAnswers'); // Clear saved answers
            window.location.href = "choose.html";
        });
    </script>
</body>
</html>
